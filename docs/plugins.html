<!doctype html>
<html VERSION-5="5" VERSION-4="4" version="5">
<head>
    <title>The Wizzi Factory</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" />
    <link href="../sanitize.css" rel="stylesheet" />
    <link href="../wizzifactory.css" rel="stylesheet" />
</head>
<body class="docs-plugins">
    <div class="site">
        <header class="navigation-sub">
            <div class="container navigation__inner">
                <a href="../index.html"><img width="100" height="44px" src="../logo.svg" />
                </a>
                <nav class="navigation__links">
                    <a title="docs concepts" href="../concepts.html" class="navigation__link">Concepts</a>
                    <a title="docs docs" href="../docs/intro.html" class="navigation__link navigation__link--active">Docs</a>
                    <a title="docs api" href="../api.html" class="navigation__link">Api</a>
                    <a title="docs code" href="../code/intro.html" class="navigation__link">Code</a>
                    <a title="docs starters" href="../starters.html" class="navigation__link">Starters</a>
                    <a title="docs project" href="../project.html" class="navigation__link">Project</a>
                </nav>
                <div class="navigation__search">
                    <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;">
                        <input type="text" class="navigation__search-input ds-input" placeholder="Search documentationâ€¦" autocomplete="off" spellcheck="false" role="combobox" aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0" dir="auto" style="position: relative; vertical-align: top;" />
                        <pre aria-hidden="true" style="position: absolute; visibility: hidden; white-space: pre; font-family: Arial; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; word-spacing: 0px; letter-spacing: normal; text-indent: 7px; text-rendering: auto; text-transform: none;"></pre>
                        <span class="ds-dropdown-menu" role="listbox" id="algolia-autocomplete-listbox-0" style="position: absolute; top: 100%; z-index: 100; display: none; left: 0px; right: auto;">
                            <div class="ds-dataset-1"></div>
                        </span>
                    </span>
                    <button class="navigation__search-icon icon-search"></button>
                    <button class="navigation__search-icon icon-cross"></button>
                </div>
                <a href="https://github.com/wizzifactory" target="_blank" class="navigation__icon" title="GitHub Repository"><i class="sidecar__icon icon-github"></i>
                </a>
                <a href="https://stackoverflow.com/questions/tagged/wizzifactory" target="_blank" class="navigation__icon" title="See Questions on Stack Overflow"><i class="sidecar__icon icon-stackoverflow"></i>
                </a>
                <a href="#" target="_blank" class="navigation__icon" title="Follow on twitter"><i class="sidecar__icon icon-twitter"></i>
                </a>
                <a href="#" target="_blank" class="navigation__icon" title="Follow on facebook"><i class="sidecar__icon icon-facebook"></i>
                </a>
            </div>
            <div class="navigation__bottom">
                <div class="container navigation__inner">
                    <a class="navigation__child" title="intro ittf source code" href="intro.html">intro</a>
                    <a class="navigation__child" title="ittf ittf source code" href="ittf.html">ittf</a>
                    <a class="navigation__child" title="jswizzi ittf source code" href="jswizzi.html">jswizzi</a>
                    <a class="navigation__child" title="models ittf source code" href="models.html">models</a>
                    <a class="navigation__child" title="artifacts ittf source code" href="artifacts.html">artifacts</a>
                    <a class="navigation__child" title="jobs ittf source code" href="jobs.html">jobs</a>
                    <a class="navigation__child navigation__child--active" title="plugins ittf source code" href="plugins.html">plugins</a>
                </div>
            </div>
        </header>
        <main id="wrapper-sub">
            <nav class="main-sidebar-left main-sidebar-left-sub">
                <img src="../workinprogress.jpg" />
                <section id="main-toc" class="toc toc sidebar__inner">
                    <h3>Contents:</h3>
                    <ol>
                        <li><a href="#concept-1">Plugins</a>
                        </li>
                        <li><a href="#concept-2">Plugin management</a>
                        </li>
                        <li><a href="#concept-3">wizzi-plugin.factoryPlugin API</a>
                        </li>
                    </ol>
                </section>
            </nav>
            <div class="main-content">
                <h2 id="concept-1" class="concept">Plugins</h2>
                <div class="summary">
                    <p>The wizzi factory is a pluggable artifact generation framework fully implemented by plugins.</p><p>Kernel modules themself have a pluggable architecture. The wizzi-mtree package is a plugin that implements an api for building tree structures from documents. Repositories of source ittf documents are plugins that implement an api for locating and retrieving documents.</p><p>In this section we will focus on the wizzi plugins that implement modeling and artifact generation.</p><p>A wizzi plugin exposes to the wizzi factory:</p><ul>    <li>wizzi schemas and relative factories of wizzi models;    </li><li>model transformers;    </li><li>artifact generators.    </li></ul><h4>A plugin package must export the method 'createFactoryPlugin'</h4><pre class="prettyprint"><ol class="linenums"><li class="L1"><span class="pnl"></span><span class="tag">set</span><span class="pln"> module.exports</span></li><li class="L2"><span class="pnl">  </span><span class="tag">{</span><span class="pln"> </span></li><li class="L3"><span class="pnl">    </span><span class="tag">...</span><span class="pln"> </span></li><li class="L4"><span class="pnl">    </span><span class="tag">@</span><span class="pln"> createFactoryPlugin</span></li><li class="L5"><span class="pnl">      </span><span class="tag">function</span><span class="pln"> </span></li><li class="L6"><span class="pnl">        </span><span class="tag">{</span><span</span><span class="pln"> wizziPackage</span></li><li class="L7"><span class="pnl">        </span><span class="tag">{</span><span</span><span</span><span class="pln"> options</span></li><li class="L8"><span class="pnl">          </span><span class="tag">[</span><span class="pln"> items</span></li><li class="L9"><span class="pnl">            </span><span class="tag">string</span><span class="pln"> pluginNameOrFile</span></li><li class="L0"><span class="pnl">          </span><span class="tag">string</span><span class="pln"> pluginsBaseFolder</span></li><li class="L1"><span class="pnl">            </span><span class="tag">default</span><span class="pln"> process.cwd()</span></li><li class="L2"><span class="pnl">        </span><span class="tag">callback</span><span class="pln"> </span></li><li class="L3"><span class="pnl">        </span><span class="tag">...</span><span class="pln"> </span></li><li class="L4"><span class="pnl">        </span><span class="tag">return</span><span class="pln"> </span></li><li class="L5"><span class="pnl">          </span><span class="tag">_</span><span class="pln"> callback</span></li><li class="L6"><span class="pnl">            </span><span class="tag">{</span><span</span><span</span><span</span><span class="pln"> factoryPlugin</span></li><li class="L7"><span class="pnl">              </span><span class="tag">api-ref</span><span class="pln"> wizzi-plugin.factoryPlugin</span></li></ol></pre><p>The FactoryPlugin class instance returned to the caller must implement the wizzi-plugin.factoryPlugin API (see below).</p><p>A wizzi plugin should have a standard folder structure like this one:</p><pre class="prettyprint"><ol class="linenums"><li class="L1"><span class="pnl"></span><span class="tag">...</span><span class="pln"> </span></li><li class="L2"><span class="pnl">  </span><span class="tag">`package-name`</span><span class="pln"> </span></li><li class="L3"><span class="pnl">    </span><span class="tag">lib</span><span class="pln"> </span></li><li class="L4"><span class="pnl">      </span><span class="tag">artifacts</span><span class="pln"> </span></li><li class="L5"><span class="pnl">        </span><span class="tag">`schema-name`</span><span class="pln"> </span></li><li class="L6"><span class="pnl">          </span><span class="tag">`artifact-name`</span><span class="pln"> </span></li><li class="L7"><span class="pnl">            </span><span class="tag">gen</span><span class="pln"> </span></li><li class="L8"><span class="pnl">              </span><span class="tag">main.js</span><span class="pln"> </span></li><li class="L9"><span class="pnl">          </span><span class="tag">...</span><span class="pln"> </span></li><li class="L0"><span class="pnl">          </span><span class="tag">`transformer-name`</span><span class="pln"> </span></li><li class="L1"><span class="pnl">            </span><span class="tag">trans</span><span class="pln"> </span></li><li class="L2"><span class="pnl">              </span><span class="tag">main.js</span><span class="pln"> </span></li><li class="L3"><span class="pnl">          </span><span class="tag">...</span><span class="pln"> </span></li><li class="L4"><span class="pnl">        </span><span class="tag">...</span><span class="pln"> </span></li><li class="L5"><span class="pnl">      </span><span class="tag">utils</span><span class="pln"> </span></li><li class="L6"><span class="pnl">        </span><span class="tag">...</span><span class="pln"> </span></li><li class="L7"><span class="pnl">      </span><span class="tag">wizzi</span><span class="pln"> </span></li><li class="L8"><span class="pnl">        </span><span class="tag">models</span><span class="pln"> </span></li><li class="L9"><span class="pnl">          </span><span class="tag">`schema-name`-model.g.js</span><span class="pln"> </span></li><li class="L0"><span class="pnl">          </span><span class="tag">`schema-name`-factory.g.js</span><span class="pln"> </span></li><li class="L1"><span class="pnl">          </span><span class="tag">`schema-name`-schema.g.html</span><span class="pln"> </span></li><li class="L2"><span class="pnl">          </span><span class="tag">`schema-name`-schema.g.json</span><span class="pln"> </span></li><li class="L3"><span class="pnl">          </span><span class="tag">...</span><span class="pln"> </span></li><li class="L4"><span class="pnl">        </span><span class="tag">schemas</span><span class="pln"> </span></li><li class="L5"><span class="pnl">          </span><span class="tag">`schema-name`.wfschema.ittf</span><span class="pln"> </span></li><li class="L6"><span class="pnl">          </span><span class="tag">...</span><span class="pln"> </span></li><li class="L7"><span class="pnl">    </span><span class="tag">index.js</span><span class="pln"> </span></li></ol></pre><p>In this way modules can be located given the short public name of the required objects.</p></div>
                <h2 id="concept-2" class="concept">Plugin management</h2>
                <div class="summary">
                    <p>The wizzi factory uses a class instance that implements the wizzi.pluginsManager api to resolve and load plugin packages or files.</p><p>Wizzi plugins can be nodejs packages installed locally or globally or can be folders in a package that makes a private use of them.</p><p>Plugins to be used by an instance of the wizzi.WizziFactory class must be requested at initialization time and cannot be changed later. A new instance of the factory must be created to use a different configuration of plugins.</p><p>This is the api of the wizzi.WizziFactory.initialize method.</p><pre class="prettyprint"><ol class="linenums"><li class="L1"><span class="pnl"></span><span class="tag">...</span><span class="pln"> </span></li><li class="L2"><span class="pnl">  </span><span class="tag">m</span><span class="pln"> initialize</span></li><li class="L3"><span class="pnl">    </span><span class="tag">{</span><span class="pln"> options</span></li><li class="L4"><span class="pnl">      </span><span class="tag">{</span><span</span><span class="pln"> repo</span></li><li class="L5"><span class="pnl">        </span><span class="tag">...</span><span class="pln"> </span></li><li class="L6"><span class="pnl">      </span><span class="tag">{</span><span</span><span</span><span class="pln"> plugins</span></li><li class="L7"><span class="pnl">        </span><span class="tag">[</span><span class="pln"> items</span></li><li class="L8"><span class="pnl">          </span><span class="tag">string</span><span class="pln"> pluginNameOrFile</span></li><li class="L9"><span class="pnl">        </span><span class="tag">string</span><span class="pln"> pluginsBaseFolder</span></li><li class="L0"><span class="pnl">          </span><span class="tag">default</span><span class="pln"> process.cwd()</span></li><li class="L1"><span class="pnl">      </span><span class="tag">{</span><span</span><span</span><span</span><span class="pln"> test</span></li><li class="L2"><span class="pnl">        </span><span class="tag">...</span><span class="pln"> </span></li></ol></pre><p>The 'items' property of the 'options.plugins' object is an array of:    <ul>        <li>Package names, when plugins are contained in npm installed nodejs packages        </li><li>Relative paths to plugins index module, when plugins are contained in private folders.        </li>    </ul></p><span>In the case of relative paths the property 'pluginsBaseFolder' of the 'options.plugins' object must contains the base folder of plugins index modules.</span></div>
                <h2 id="concept-3" class="concept">wizzi-plugin.factoryPlugin API</h2>
                <div class="summary">
                    <p>This api must be implemented by any wizzi plugin.</p><p>The methods of the api will be called by the wizzi.pluginsManager instance class on requests received by the wizzi.wizziFactory instance class.</p><pre class="prettyprint"><ol class="linenums"><li class="L1"><span class="pnl"></span><span class="tag"></span><span class="pln"> </span></li><li class="L2"><span class="pnl">  </span><span class="tag">#</span><span class="pln"> </span></li><li class="L3"><span class="pnl">    </span><span class="tag">#</span><span class="pln"> Retrieve a wizzi model factory by its schema name</span></li><li class="L4"><span class="pnl">    </span><span class="tag">#</span><span class="pln"> Searching in this wizzi package. No search up in "node_modules" folders.</span></li><li class="L5"><span class="pnl">  </span><span class="tag">m</span><span class="pln"> getModelFactory</span></li><li class="L6"><span class="pnl">    </span><span class="tag">string</span><span class="pln"> schemaName</span></li><li class="L7"><span class="pnl">    </span><span class="tag">...</span><span class="pln"> </span></li><li class="L8"><span class="pnl">  </span><span class="tag"></span><span class="pln"> </span></li><li class="L9"><span class="pnl">  </span><span class="tag">#</span><span class="pln"> </span></li><li class="L0"><span class="pnl">    </span><span class="tag">#</span><span class="pln"> Retrieve a model transformer by its name</span></li><li class="L1"><span class="pnl">    </span><span class="tag">#</span><span class="pln"> Searching in this wizzi package. No search up in "node_modules" folders.</span></li><li class="L2"><span class="pnl">  </span><span class="tag">m</span><span class="pln"> getModelTransformer</span></li><li class="L3"><span class="pnl">    </span><span class="tag">string</span><span class="pln"> transformerName</span></li><li class="L4"><span class="pnl">    </span><span class="tag">...</span><span class="pln"> </span></li><li class="L5"><span class="pnl">  </span><span class="tag"></span><span class="pln"> </span></li><li class="L6"><span class="pnl">  </span><span class="tag">#</span><span class="pln"> </span></li><li class="L7"><span class="pnl">    </span><span class="tag">#</span><span class="pln"> Retrieve an artifact generator by its name</span></li><li class="L8"><span class="pnl">    </span><span class="tag">#</span><span class="pln"> Searching in this wizzi package. No search up in "node_modules" folders.</span></li><li class="L9"><span class="pnl">  </span><span class="tag">m</span><span class="pln"> getArtifactGenerator</span></li><li class="L0"><span class="pnl">    </span><span class="tag">string</span><span class="pln"> generationName</span></li><li class="L1"><span class="pnl">  </span><span class="tag"></span><span class="pln"> </span></li><li class="L2"><span class="pnl">  </span><span class="tag">#</span><span class="pln"> </span></li><li class="L3"><span class="pnl">    </span><span class="tag">#</span><span class="pln"> Retrieve a wizzi schema definition in JSON format</span></li><li class="L4"><span class="pnl">    </span><span class="tag">#</span><span class="pln"> Searching in this wizzi package. No search up in "node_modules" folders.</span></li><li class="L5"><span class="pnl">  </span><span class="tag">m</span><span class="pln"> getSchemaDefinition</span></li><li class="L6"><span class="pnl">    </span><span class="tag">string</span><span class="pln"> schemaName</span></li></ol></pre><h4>Api of the object returned by getModelFactory</h4><p>This api will be requested to the wizzi.pluginsManager from the wizzi.wizziFactory when a client requires to load a wizzi nodel of a given schema. It will be the wizzi.wizziFactory to call the 'createLoadModel' and the 'loadModel' functions and not the client code.</p><pre class="prettyprint"><ol class="linenums"><li class="L1"><span class="pnl"></span><span class="tag">{</span><span class="pln"> </span></li><li class="L2"><span class="pnl">  </span><span class="tag">func</span><span class="pln"> createLoadModel</span></li><li class="L3"><span class="pnl">    </span><span class="tag">#</span><span class="pln"> HOF : returns the loadModel function for the given factory</span></li><li class="L4"><span class="pnl">    </span><span class="tag">{</span><span</span><span class="pln"> wizziObject</span></li><li class="L5"><span class="pnl">      </span><span class="tag">func</span><span class="pln"> loadMTree</span></li><li class="L6"><span class="pnl">        </span><span class="tag">api-ref</span><span class="pln"> wizzi-mtree.loader.loadMTree</span></li><li class="L7"><span class="pnl">        </span><span class="tag">#</span><span class="pln"> This function is prepared by the wizzi.wizziFactory instance class</span></li><li class="L8"><span class="pnl">        </span><span class="tag">#</span><span class="pln"> and has repository access functions and load options in its closure.</span></li><li class="L9"><span class="pnl">      </span><span class="tag">{</span><span</span><span</span><span class="pln"> file</span></li><li class="L0"><span class="pnl">        </span><span class="tag">api-ref</span><span class="pln"> wizzi.util.file</span></li><li class="L1"><span class="pnl">      </span><span class="tag">{</span><span</span><span</span><span</span><span class="pln"> errors</span></li><li class="L2"><span class="pnl">        </span><span class="tag">api-ref</span><span class="pln"> wizzi.errors</span></li><li class="L3"><span class="pnl">    </span><span class="tag">...</span><span class="pln"> </span></li><li class="L4"><span class="pnl">    </span><span class="tag">return</span><span class="pln"> </span></li><li class="L5"><span class="pnl">      </span><span class="tag">func</span><span class="pln"> loadModel</span></li><li class="L6"><span class="pnl">        </span><span class="tag">#</span><span class="pln"> This returned function require a complex 'loadContext'</span></li><li class="L7"><span class="pnl">        </span><span class="tag">#</span><span class="pln"> parameter with a lot of interfaces passed.</span></li><li class="L8"><span class="pnl">        </span><span class="tag">#</span><span class="pln"> It will be called by the wizzi.wizziFactory instance and</span></li><li class="L9"><span class="pnl">        </span><span class="tag">#</span><span class="pln"> not directly from client code.</span></li><li class="L0"><span class="pnl">        </span><span class="tag">string</span><span class="pln"> ittfDocumentUri</span></li><li class="L1"><span class="pnl">          </span><span class="tag">#</span><span class="pln"> The path to the primary ittf document from which</span></li><li class="L2"><span class="pnl">          </span><span class="tag">#</span><span class="pln"> the mTree will be loaded</span></li><li class="L3"><span class="pnl">        </span><span class="tag">{</span><span</span><span</span><span</span><span</span><span class="pln"> loadContext</span></li><li class="L4"><span class="pnl">          </span><span class="tag">{</span><span</span><span</span><span</span><span</span><span</span><span class="pln"> __productionManager</span></li><li class="L5"><span class="pnl">            </span><span class="tag">api-ref</span><span class="pln"> wizzi.production.productionManager</span></li><li class="L6"><span class="pnl">            </span><span class="tag">{</span><span</span><span</span><span</span><span</span><span</span><span</span><span class="pln"> productionContext</span></li><li class="L7"><span class="pnl">              </span><span class="tag">api-ref</span><span class="pln"> wizzi.production.productionContext</span></li><li class="L8"><span class="pnl">              </span><span class="tag">{</span><span</span><span</span><span</span><span</span><span</span><span</span><span</span><span class="pln"> aclstat</span></li><li class="L9"><span class="pnl">                </span><span class="tag">api-ref</span><span class="pln"> wizzi.production.aclstat</span></li><li class="L0"><span class="pnl">          </span><span class="tag">{</span><span</span><span</span><span</span><span</span><span</span><span</span><span</span><span</span><span class="pln"> __ittfDocumentStore</span></li><li class="L1"><span class="pnl">            </span><span class="tag">api-ref</span><span class="pln"> wizzi-repo.ittfDocumentStore</span></li><li class="L2"><span class="pnl">          </span><span class="tag">{</span><span</span><span</span><span</span><span</span><span</span><span</span><span</span><span</span><span</span><span class="pln"> mTreeBuildUpContext</span></li><li class="L3"><span class="pnl">            </span><span class="tag">optional</span><span class="pln"> </span></li><li class="L4"><span class="pnl">            </span><span class="tag">|</span><span class="pln"> api-ref wizzi-plugin.wizziModel</span></li><li class="L5"><span class="pnl">            </span><span class="tag">|</span><span class="pln"> POJO</span></li><li class="L6"><span class="pnl">        </span><span class="tag">callback</span><span class="pln"> </span></li></ol></pre><h4>Api of the object returned by getModelTransformer</h4><pre class="prettyprint"><ol class="linenums"><li class="L1"><span class="pnl"></span><span class="tag">{</span><span class="pln"> </span></li><li class="L2"><span class="pnl">  </span><span class="tag">func</span><span class="pln"> trans</span></li><li class="L3"><span class="pnl">    </span><span class="tag">{</span><span</span><span class="pln"> model</span></li><li class="L4"><span class="pnl">      </span><span class="tag">|</span><span class="pln"> api-ref wizzi-plugin.wizziModel</span></li><li class="L5"><span class="pnl">      </span><span class="tag">|</span><span class="pln"> POJO</span></li><li class="L6"><span class="pnl">    </span><span class="tag">{</span><span</span><span</span><span class="pln"> ctx</span></li><li class="L7"><span class="pnl">      </span><span class="tag">api-ref</span><span class="pln"> wizzi.artifact.genContext</span></li><li class="L8"><span class="pnl">    </span><span class="tag">callback</span><span class="pln"> </span></li></ol></pre><h4>Api of the object returned by getArtifactGenerator</h4><pre class="prettyprint"><ol class="linenums"><li class="L1"><span class="pnl"></span><span class="tag">{</span><span class="pln"> </span></li><li class="L2"><span class="pnl">  </span><span class="tag">func</span><span class="pln"> gen</span></li><li class="L3"><span class="pnl">    </span><span class="tag">{</span><span</span><span class="pln"> model</span></li><li class="L4"><span class="pnl">      </span><span class="tag">|</span><span class="pln"> api-ref wizzi-plugin.wizziModel</span></li><li class="L5"><span class="pnl">      </span><span class="tag">|</span><span class="pln"> POJO</span></li><li class="L6"><span class="pnl">    </span><span class="tag">{</span><span</span><span</span><span class="pln"> ctx</span></li><li class="L7"><span class="pnl">      </span><span class="tag">api-ref</span><span class="pln"> wizzi.artifact.genContext</span></li><li class="L8"><span class="pnl">    </span><span class="tag">callback</span><span class="pln"> </span></li></ol></pre><h4>Api of the object returned by getSchemaDefinition</h4><p>The object returned is a json representation of the requested schema.</p></div>
                <section></section>
            </div>
        </main>
    </div>
    <script src="jquery-3.2.1.js"></script>
    <script src="../wizzifactory.js"></script>
</body>

</html>
