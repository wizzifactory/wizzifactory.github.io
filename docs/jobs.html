<!doctype html>
<html VERSION-5="5" VERSION-4="4" version="5">
    <head>
        <title>The Wizzi Factory</title>
        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
        <link href="../normalize.css" rel="stylesheet">
        <link href="../wizzifactory.css" rel="stylesheet">
    </head>
    <body class="docs-jobs">
        <div class="site">
            <header class="navigation">
                <div class="container navigation__inner">
                    <div class="logo">
                        <span class="logo-w">W</span>
                        <span class="logo-i1">i</span>
                        <span class="logo-z1">z</span>
                        <span class="logo-z2">z</span>
                        <span class="logo-i2">i</span>
                        <span>&nbsp;</span>
                        <span class="logo-f">f</span>
                        <span class="logo-a">a</span>
                        <span class="logo-c">c</span>
                        <span class="logo-t">t</span>
                        <span class="logo-o">o</span>
                        <span class="logo-r">r</span>
                        <span class="logo-y">y</span>
                    </div>
                    <nav class="navigation__links">
                        <a title="docs concepts" href="../concepts.html" class="navigation__link">Concepts</a>
                        <a title="docs docs" href="../docs/intro.html" class="navigation__link navigation__link--active">Docs</a>
                        <a title="docs api" href="../api.html" class="navigation__link">Api</a>
                        <a title="docs code" href="../code/intro.html" class="navigation__link">Code</a>
                        <a title="docs starters" href="../starters.html" class="navigation__link">Starters</a>
                        <a title="docs project" href="../project.html" class="navigation__link">Project</a>
                    </nav>
                    <div class="navigation__search">
                        <span class="algolia-autocomplete" style="position: relative; display: inline-block; direction: ltr;">
                            <input type="text" class="navigation__search-input ds-input" placeholder="Search documentationâ€¦" autocomplete="off" spellcheck="false" role="combobox" aria-autocomplete="list" aria-expanded="false" aria-owns="algolia-autocomplete-listbox-0" dir="auto" style="position: relative; vertical-align: top;">
                            <pre aria-hidden="true" style="position: absolute; visibility: hidden; white-space: pre; font-family: Arial; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; word-spacing: 0px; letter-spacing: normal; text-indent: 7px; text-rendering: auto; text-transform: none;"></pre>
                            <span class="ds-dropdown-menu" role="listbox" id="algolia-autocomplete-listbox-0" style="position: absolute; top: 100%; z-index: 100; display: none; left: 0px; right: auto;">
                                <div class="ds-dataset-1"></div>
                            </span>
                        </span>
                        <button class="navigation__search-icon icon-search"></button>
                        <button class="navigation__search-icon icon-cross"></button>
                    </div>
                    <a href="https://github.com/wizzifactory" target="_blank" class="navigation__icon" title="GitHub Repository"><i class="sidecar__icon icon-github"></i>
                    </a>
                    <a href="https://stackoverflow.com/questions/tagged/wizzifactory" target="_blank" class="navigation__icon" title="See Questions on Stack Overflow"><i class="sidecar__icon icon-stackoverflow"></i>
                    </a>
                    <a href="#" target="_blank" class="navigation__icon" title="Follow on twitter"><i class="sidecar__icon icon-twitter"></i>
                    </a>
                    <a href="#" target="_blank" class="navigation__icon" title="Follow on facebook"><i class="sidecar__icon icon-facebook"></i>
                    </a>
                </div>
                <div class="navigation__bottom">
                    <div class="container navigation__inner">
                        <a class="navigation__child" title="intro ittf source code" href="intro.html">intro</a>
                        <a class="navigation__child" title="ittf ittf source code" href="ittf.html">ittf</a>
                        <a class="navigation__child" title="jswizzi ittf source code" href="jswizzi.html">jswizzi</a>
                        <a class="navigation__child" title="models ittf source code" href="models.html">models</a>
                        <a class="navigation__child" title="artifacts ittf source code" href="artifacts.html">artifacts</a>
                        <a class="navigation__child navigation__child--active" title="jobs ittf source code" href="jobs.html">jobs</a>
                        <a class="navigation__child" title="plugins ittf source code" href="plugins.html">plugins</a>
                        <a class="navigation__child" title="wfschema ittf source code" href="wfschema.html">wfschema</a>
                        <a class="navigation__child" title="wfjob ittf source code" href="wfjob.html">wfjob</a>
                        <a class="navigation__child" title="wfpackage ittf source code" href="wfpackage.html">wfpackage</a>
                    </div>
                </div>
            </header>
            <main id="main-content">
                <nav class="main-sidebar-left" style="max-height: 648px; position: fixed; top: 90px; width: 280px;">
                    <img src="../workinprogress.jpg">
                    <section id="main-toc" class="toc toc sidebar__inner">
                        <h3>Contents:</h3>
                        <ol>
                            <li><a href="#concept-1">The production manager</a>
                            </li>
                            <li><a href="#concept-2">The 'wfjob" schema</a>
                            </li>
                            <li><a href="#concept-3">The 'runnerServer" execution environment.</a>
                            </li>
                        </ol>
                    </section>
                </nav>
                <div class="main-content">
                    <h2 id="concept-1" class="concept">The production manager</h2>
                    <div class="summary">
                        <p>The production of complex software systems can require a great number of model processing, transformations and artifact generations.</p><p>The wizzi.production.productionManager class implements an api for scheduling complex jobs. It is the wizzi factory task manager.</p><p>A wizzi model type implemented by the 'wizzi-core' plugin , the 'wfjob' schema, can be used to describe wizzi factory jobs. A 'wfjob' model organizes models processing and artifact generations in production lines that are executed in sequence, so that a line can prepare models and artifacts for the next one.</p><p>A job is executed calling the following method of the wizzi.wizziFactory instance class.</p><pre class="prettyprint"><ol class="linenums"><li class="L1"><span class="pnl"></span><span class="tag">...</span><span class="pln"> </span></li><li class="L2"><span class="pnl">  </span><span class="tag">m</span><span class="pln"> executeJob</span></li><li class="L3"><span class="pnl">    </span><span class="tag">{</span><span class="pln"> jobRequest</span></li><li class="L4"><span class="pnl">      </span><span class="tag">string</span><span class="pln"> name</span></li><li class="L5"><span class="pnl">        </span><span class="tag">#</span><span class="pln"> for info and error messages</span></li><li class="L6"><span class="pnl">      </span><span class="tag">string</span><span class="pln"> path</span></li><li class="L7"><span class="pnl">        </span><span class="tag">#</span><span class="pln"> path to the 'wfjob' ittf document that the wizzi.production.productionManager will load.</span></li><li class="L8"><span class="pnl">      </span><span class="tag">{</span><span</span><span class="pln"> productionOptions</span></li><li class="L9"><span class="pnl">        </span><span class="tag">boolean</span><span class="pln"> verbose</span></li><li class="L0"><span class="pnl">          </span><span class="tag">#</span><span class="pln"> not implemented yet</span></li><li class="L1"><span class="pnl">      </span><span class="tag">{</span><span</span><span</span><span class="pln"> globalContext</span></li><li class="L2"><span class="pnl">        </span><span class="tag">optional</span><span class="pln"> </span></li><li class="L3"><span class="pnl">    </span><span class="tag">callback</span><span class="pln"> </span></li></ol></pre></div>
                    <h2 id="concept-2" class="concept">The 'wfjob" schema</h2>
                    <div class="summary">
                        <p>The wfjob schema, implemented by the wizzi-core plugin, is the configuration schema of the production manager, the wizzi task manager.</p><h4>The wfjob elements are</h4><ul>    <li>Wfjob    </li><li>Model    </li><li>ModelRef    </li><li>Line    </li><li>LineRef    </li><li>Artifact    </li><li>Production    </li></ul><h3>The WfJob element</h3><pre class="prettyprint"><ol class="linenums"><li class="L1"><span class="pnl"></span><span class="tag">wfjob</span><span class="pln"> `name`</span></li><li class="L2"><span class="pnl">  </span><span class="tag">#</span><span class="pln"> For info and error messages</span></li><li class="L3"><span class="pnl">  </span><span class="tag">string</span><span class="pln"> title `short-description`</span></li><li class="L4"><span class="pnl">    </span><span class="tag">#</span><span class="pln"> For info and error messages</span></li><li class="L5"><span class="pnl">  </span><span class="tag">string</span><span class="pln"> models-base-folder `path`</span></li><li class="L6"><span class="pnl">    </span><span class="tag">#</span><span class="pln"> The base path to use when the 'src' attribute of models is a relative path</span></li><li class="L7"><span class="pnl">  </span><span class="tag">string</span><span class="pln"> dest-base-folder `path`</span></li><li class="L8"><span class="pnl">    </span><span class="tag">#</span><span class="pln"> The base path of the destination folder of artifacts generated by this job</span></li><li class="L9"><span class="pnl">    </span><span class="tag">#</span><span class="pln"> Can be overridden by the 'dest-folder' attribute of Line elements</span></li><li class="L0"><span class="pnl">  </span><span class="tag">[</span><span class="pln"> models</span></li><li class="L1"><span class="pnl">  </span><span class="tag">[</span><span class="pln"> lines</span></li><li class="L2"><span class="pnl">  </span><span class="tag">[</span><span class="pln"> productions</span></li></ol></pre><h3>Model element</h3><p>A model can be:</p><ul>    <li>An ittf documents targeting a wizzi schema exposed by a plugin loaded in the wizzi.wizziFactory instance that is executing the job.    </li><li>A POJO module coded in one of these known formats: 'json', 'nodejs' module exporting the function 'toModel'.    </li></ul><pre class="prettyprint"><ol class="linenums"><li class="L1"><span class="pnl"></span><span class="tag">...</span><span class="pln"> </span></li><li class="L2"><span class="pnl">  </span><span class="tag">model</span><span class="pln"> `model-name`</span></li><li class="L3"><span class="pnl">    </span><span class="tag">string</span><span class="pln"> src `path`</span></li><li class="L4"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> The source path of the ittf document or POJO module.</span></li><li class="L5"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> When relative the base path is the 'models-base-folder' attribute of the</span></li><li class="L6"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> WfJob element.</span></li><li class="L7"><span class="pnl">    </span><span class="tag">string</span><span class="pln"> schema `schema-name`</span></li><li class="L8"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> The name of the wizzi model type (wfschema) that will load the</span></li><li class="L9"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> mTree defined in the source ittf document.</span></li><li class="L0"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> Is alternative to the 'format' attribute.</span></li><li class="L1"><span class="pnl">    </span><span class="tag">string</span><span class="pln"> format `format-name`</span></li><li class="L2"><span class="pnl">      </span><span class="tag">One-of</span><span class="pln"> 'json', 'nodejs'</span></li><li class="L3"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> Is alternative to 'schema' attribute.</span></li><li class="L4"><span class="pnl">    </span><span class="tag">string</span><span class="pln"> dump-file `path`</span></li><li class="L5"><span class="pnl">    </span><span class="tag">[</span><span class="pln"> modelRefs</span></li><li class="L6"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> References to the models to be used, as properties of the mTreeBuildUpContext</span></li><li class="L7"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> parameter, passed to the wizzi-mtree.loader.loadMTree function,</span></li><li class="L8"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> for loading the model mTree.</span></li></ol></pre><h3>ModelRef element</h3><pre class="prettyprint"><ol class="linenums"><li class="L1"><span class="pnl"></span><span class="tag">...</span><span class="pln"> </span></li><li class="L2"><span class="pnl">  </span><span class="tag">model-ref</span><span class="pln"> `model-name`</span></li><li class="L3"><span class="pnl">    </span><span class="tag">string</span><span class="pln"> export-name `name`</span></li><li class="L4"><span class="pnl">    </span><span class="tag">[</span><span class="pln"> transformers</span></li></ol></pre><h3>Line element</h3><p>Production lines declare artifacts that are processed asynchronously and concurrently.</p><pre class="prettyprint"><ol class="linenums"><li class="L1"><span class="pnl"></span><span class="tag">...</span><span class="pln"> </span></li><li class="L2"><span class="pnl">  </span><span class="tag">line</span><span class="pln"> `line-name`</span></li><li class="L3"><span class="pnl">    </span><span class="tag">string</span><span class="pln"> cwd-folder `path`</span></li><li class="L4"><span class="pnl">    </span><span class="tag">string</span><span class="pln"> dest-folder `path`</span></li><li class="L5"><span class="pnl">    </span><span class="tag">[</span><span class="pln"> artifacts</span></li></ol></pre><h3>Artifact element</h3><p>An Artifact element declares one artifact production that is driven by a source model. Each production has one driver model, but an Artifact element can result in many production because the 'src' attribute of this element may refer to:    <ul>        <li>one single source model        </li><li>a group of source models described by a glob pattern        </li><li>one single source model which Model element declares a model collection property, meaning that each item of the collection is a source model of the production and produces one artifact.        </li>    </ul></p><pre class="prettyprint"><ol class="linenums"><li class="L1"><span class="pnl"></span><span class="tag">...</span><span class="pln"> </span></li><li class="L2"><span class="pnl">  </span><span class="tag">artifact</span><span class="pln"> `artifact-name`</span></li><li class="L3"><span class="pnl">    </span><span class="tag">#</span><span class="pln"> For info and errors messages.</span></li><li class="L4"><span class="pnl">    </span><span class="tag">string</span><span class="pln"> src `path` | `glob-pattern`</span></li><li class="L5"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> Can be:</span></li><li class="L6"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> . the path of a final artifact that must be simply copied in the destination path.</span></li><li class="L7"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> . the glob-pattern of final artifacts that must be simply copied in the destination path.</span></li><li class="L8"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> . the path of a source ittf document</span></li><li class="L9"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> . the glob-pattern of sources ittf documents</span></li><li class="L0"><span class="pnl">    </span><span class="tag">schema</span><span class="pln"> `schema-name`</span></li><li class="L1"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> When the 'src' attribute is the path of an ittf document, is the wizzi</span></li><li class="L2"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> model type (wfschema) that will load and validate the document.</span></li><li class="L3"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> Is alternative to the 'format' attribute.</span></li><li class="L4"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> Can be null if the artifact is a final artifact.</span></li><li class="L5"><span class="pnl">    </span><span class="tag">ignore</span><span class="pln"> `path` | `glob-pattern`</span></li><li class="L6"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> Files returned by the 'src' attribute glob-pattern that are to be ignored.</span></li><li class="L7"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> Can be a glob pattern.</span></li><li class="L8"><span class="pnl">    </span><span class="tag">generation</span><span class="pln"> `artifact-generator-name`</span></li><li class="L9"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> The name of the artifact generator that will produce the artifact.</span></li><li class="L0"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> When the artifact is a final artifact must be omitted.</span></li><li class="L1"><span class="pnl">    </span><span class="tag">dest-path</span><span class="pln"> `artifact-file-path`</span></li><li class="L2"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> The 'src' attribute is the default</span></li><li class="L3"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> relative destination path of the generated artifact,</span></li><li class="L4"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> but, when set, this attribute overrides the default.</span></li><li class="L5"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> It may be an absolute path.</span></li><li class="L6"><span class="pnl">    </span><span class="tag">extension</span><span class="pln"> `artifact-file-extension`</span></li><li class="L7"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> The path extension of the generated artifact.</span></li><li class="L8"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> Optional. The default is the 'src' atribute path extension without</span></li><li class="L9"><span class="pnl">      </span><span class="tag">#</span><span class="pln"> the ending '.ittf' string.</span></li><li class="L0"><span class="pnl">    </span><span class="tag">#</span><span class="pln"> Child elements</span></li><li class="L1"><span class="pnl">    </span><span class="tag">[</span><span class="pln"> modelRefs</span></li></ol></pre><h3>Production element</h3><p>Production elements contain a list of references to previously declared production lines that must be sequentially executed.</p><pre class="prettyprint"><ol class="linenums"><li class="L1"><span class="pnl"></span><span class="tag">...</span><span class="pln"> </span></li><li class="L2"><span class="pnl">  </span><span class="tag">production</span><span class="pln"> 'production-name'</span></li><li class="L3"><span class="pnl">    </span><span class="tag">string</span><span class="pln"> dest-folder `path`</span></li><li class="L4"><span class="pnl">    </span><span class="tag">[</span><span class="pln"> lineRefs</span></li></ol></pre><h3>LineRef element</h3><pre class="prettyprint"><ol class="linenums"><li class="L1"><span class="pnl"></span><span class="tag">...</span><span class="pln"> </span></li><li class="L2"><span class="pnl">  </span><span class="tag">line-ref</span><span class="pln"> `line-name`</span></li></ol></pre><h4>Example of the wizzi job that produces this documentation html page.</h4><pre class="prettyprint"><ol class="linenums"><li class="L1"><span class="pnl"></span><span class="tag">wfjob</span><span class="pln"> wizzi-docs-concepts</span></li><li class="L2"><span class="pnl">  </span><span class="kwd">$</span><span class="expr"> </span></li><li class="L3"><span class="pnl">    </span><span class="expr">var</span><span class="expr"> models_folder     = path.join(__dirname, 'models');</span></li><li class="L4"><span class="pnl">    </span><span class="expr">var</span><span class="expr"> html_folder       = path.join(__dirname, 'html');</span></li><li class="L5"><span class="pnl">    </span><span class="expr">var</span><span class="expr"> dest_folder       = "c:/my/wizzi/github/wizzifactory.github.io";</span></li><li class="L6"><span class="pnl">  </span><span class="tag">models-base-folder</span><span class="pln"> ${models_folder}</span></li><li class="L7"><span class="pnl">  </span><span class="tag">model</span><span class="pln"> concepts</span></li><li class="L8"><span class="pnl">    </span><span class="tag">src</span><span class="pln"> wizzi-jobs.docs.ittf</span></li><li class="L9"><span class="pnl">    </span><span class="tag">schema</span><span class="pln"> docs</span></li><li class="L0"><span class="pnl">  </span><span class="tag">line</span><span class="pln"> html</span></li><li class="L1"><span class="pnl">    </span><span class="tag">cwd-folder</span><span class="pln"> ${html_folder}</span></li><li class="L2"><span class="pnl">    </span><span class="mix">wfjob/art-wo-html(</span><span class="pln"> docs.html.ittf )</span></li><li class="L3"><span class="pnl">      </span><span class="tag">model-ref</span><span class="pln"> concepts</span></li><li class="L4"><span class="pnl">        </span><span class="tag">transformer</span><span class="pln"> docs/preprint</span></li><li class="L5"><span class="pnl">  </span><span class="tag">production</span><span class="pln"> </span></li><li class="L6"><span class="pnl">    </span><span class="tag">dest-folder</span><span class="pln"> ${dest_folder}</span></li><li class="L7"><span class="pnl">    </span><span class="tag">line-ref</span><span class="pln"> html</span></li></ol></pre></div>
                    <h2 id="concept-3" class="concept">The 'runnerServer" execution environment.</h2>
                    <div class="summary">
                        <p>When the wizzi factory is used in a server application, or in a long running process where many jobs are executed, is useful to access some factory services, prepared on startup, directly from the jswizzi code inside ittf documents.</p><p>There are two jswizzi global functions for this purpose.</p><ul>    <li>$.api( functionName, ... arguments ... )        <p>Allow to call a user function declared on start up.        </p>    </li><li>$.loadModel( modelName )        <p>Allow the retrieval of a wizzi model preloaded on start up.        </p>    </li></ul><h3>The wizzifile.js</h3><p>... TODO ...</p><h4>Event handler wizzifile.onConfig( config )</h4><p>This event is raised before creating the runnerServer instance. At this point we can call the config.get(propertyName) and config.set(propertyName, value) methods on the config object.</p><h4>Event handler wizzifile.onStart( runnerServerInstance, config )</h4><p>This event is raised before the initialization of the wizzi factory contained in the runner server. At this point we can call the runnerServerInstance.registerApi(name, function) method, the runnerServerInstance.registerPlugin(pluginNameOrPath) method and the runnerServerInstance.registerGlobalContext(object) method.</p><h4>Event handler wizzifile.onPrepare( runnerServerInstance, config )</h4><p>This event is raised when the wizzi factory contained in the runner server has benn initialized. Now it is forbidden to call the registerPlugin and registerGlobalContext methods but we can call the runnerServerInstance.loadModel and runnerServerInstance.transformModel methods.</p></div>
                    <section></section>
                </div>
            </main>
        </div>
        <script src="jquery-3.2.1.js"></script>
        <script src="../wizzifactory.js"></script>
    </body>

</html>
